<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Random Picture Generators</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
    }
    #historyPanel {
      width: 250px;
      height: 100vh;
      overflow-y: auto;
      border-right: 2px solid #ccc;
      padding: 10px;
      background: #f5f5f5;
    }
    #mainContent {
      flex-grow: 1;
      text-align: center;
      padding: 20px;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 20px;
    }
    button, input, select {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1em;
    }
    .info, .fileSize {
      margin-top: 10px;
      font-size: 0.9em;
      color: #555;
    }
    .historyItem {
      background: #fff;
      border: 1px solid #ddd;
      margin: 5px 0;
      padding: 5px;
      font-size: 0.85em;
    }
    .historyItem button {
      font-size: 0.7em;
      padding: 2px 6px;
      margin-top: 5px;
    }
    .historyTitle {
      font-weight: bold;
      margin-top: 10px;
    }
    .favorite {
      background-color: yellow;
    }
    .filters {
      margin: 10px;
    }
  </style>
</head>
<body>
  <div id="historyPanel">
    <h3>üìú History</h3>
    <div class="historyTitle">Favorited</div>
    <div id="favoritedList"></div>
    <hr>
    <div class="historyTitle">Unfavorited</div>
    <div id="historyList"></div>
    <button onclick="clearAllHistory()">Clear All History</button>
  </div>

  <div id="mainContent">
    <h1>üé® Random Picture Generators</h1>
    <input type="text" id="seedInput" placeholder="Enter seed here" />
    <br>
    <button onclick="generateRandomSeed()">Random Seed</button>
    <button onclick="generatePicture()">Generate Picture</button>
    <label>
      Chaos Level:
      <select id="chaosLevel">
        <option value="1">Simple</option>
        <option value="2">Good</option>
        <option value="3">Mess</option>
        <option value="4">SUPER DUPER ULTRA GOD LORD</option>
      </select>
    </label>
    <br>
    <label>
      Picture Size:
      <select id="canvasSize">
        <option value="200">200x200</option>
        <option value="300">300x300</option>
        <option value="400" selected>400x400</option>
        <option value="500">500x500</option>
        <option value="600">600x600</option>
        <option value="1000">1000x1000</option>
        <option value="custom">Custom (px)</option>
      </select>
      <input type="number" id="customSize" placeholder="Custom width/height" style="display: none" />
    </label>
    <br>
    <div class="filters">
      <label><input type="checkbox" id="glowFilter" /> Glow</label>
      <label><input type="checkbox" id="blurFilter" /> Blur</label>
      <label><input type="checkbox" id="invertFilter" /> Invert</label>
    </div>
    <canvas id="canvas" width="400" height="400"></canvas>
    <br>
    <button onclick="savePicture()">Save as PNG</button>
    <button onclick="goToHub()">Back to Hub</button>

    <div class="fileSize" id="fileSizeDisplay"></div>
    <div class="info">
      <p id="timeDisplay"></p>
      <p><a href="https://good-player.github.io/sigmaweb/" target="_blank">https://good-player.github.io/sigmaweb/</a> - Random picture generators</p>
    </div>
  </div>

  <script>
    function generateRandomSeed() {
      const randomSeed = Math.random().toString(36).substring(2, 10);
      document.getElementById("seedInput").value = randomSeed;
    }

    function hashSeed(seed) {
      let hash = 0;
      for (let i = 0; i < seed.length; i++) {
        hash = seed.charCodeAt(i) + ((hash << 5) - hash);
        hash = hash & hash;
      }
      return hash >>> 0;
    }

    function randomFromSeed(seedHash) {
      return () => {
        seedHash ^= seedHash << 13;
        seedHash ^= seedHash >> 17;
        seedHash ^= seedHash << 5;
        return (seedHash >>> 0) / 4294967296;
      };
    }

    function drawTextSmart(ctx, text, x, y, maxWidth, baseSize = 16) {
      let fontSize = baseSize;
      ctx.font = `${fontSize}px monospace`;
      while (ctx.measureText(text).width > maxWidth && fontSize > 6) {
        fontSize--;
        ctx.font = `${fontSize}px monospace`;
      }
      ctx.fillText(text, x, y);
    }

    function drawStar(ctx, x, y, points, outerRadius, innerRadius, color) {
      ctx.beginPath();
      ctx.moveTo(x, y - outerRadius);
      for (let i = 0; i < points * 2; i++) {
        const angle = (Math.PI * i) / points;
        const radius = i % 2 === 0 ? outerRadius : innerRadius;
        ctx.lineTo(x + radius * Math.sin(angle), y - radius * Math.cos(angle));
      }
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();
    }

    function generatePicture() {
      const seed = document.getElementById("seedInput").value.trim();
      if (!seed) return alert("Please enter a seed!");
      const chaosLevel = parseInt(document.getElementById("chaosLevel").value);
      const showSeed = true; // Always show seed in image
      const size = getCanvasSize();
      const hash = hashSeed(seed);
      const rand = randomFromSeed(hash);

      const canvas = document.getElementById("canvas");
      canvas.width = size;
      canvas.height = size;
      const ctx = canvas.getContext("2d");

      ctx.clearRect(0, 0, size, size);
      ctx.fillStyle = `hsl(${rand()*360}, 50%, 90%)`;
      ctx.fillRect(0, 0, size, size);

      // CHAOS SHAPES
      for (let i = 0; i < chaosLevel * 10; i++) {
        ctx.fillStyle = `rgba(${rand()*255},${rand()*255},${rand()*255},0.5)`;
        ctx.beginPath();
        const type = Math.floor(rand() * 5);
        if (type === 0) ctx.arc(rand()*size, rand()*size, rand()*size/10, 0, 2 * Math.PI);
        else if (type === 1) ctx.fillRect(rand()*size, rand()*size, rand()*size/8, rand()*size/8);
        else if (type === 2) {
          ctx.moveTo(rand()*size, rand()*size);
          ctx.lineTo(rand()*size, rand()*size);
          ctx.lineTo(rand()*size, rand()*size);
          ctx.closePath();
        } else drawStar(ctx, rand()*size, rand()*size, 5, rand()*10 + 5, rand()*5 + 2, ctx.fillStyle);
        ctx.fill();
      }

      ctx.strokeStyle = `rgba(0,0,0,0.3)`;
      for (let i = 0; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(rand()*size, rand()*size);
        ctx.lineTo(rand()*size, rand()*size);
        ctx.stroke();
      }

      // Filters
      if (document.getElementById("glowFilter").checked) {
        ctx.shadowBlur = 20;
        ctx.shadowColor = "white";
      }
      if (document.getElementById("blurFilter").checked) {
        ctx.filter = 'blur(5px)';
      }
      if (document.getElementById("invertFilter").checked) {
        ctx.filter = 'invert(100%)';
      }

      ctx.fillStyle = "#000";
      const padding = 10;
      const maxWidth = size - padding * 2;
      drawTextSmart(ctx, "https://good-player.github.io/sigmaweb/", padding, size - padding, maxWidth, 12);
      if (showSeed) drawTextSmart(ctx, `Seed: ${seed.slice(0, 10)}`, padding, size - padding - 20, maxWidth, 14);

      const now = new Date().toLocaleString();
      document.getElementById("timeDisplay").innerText = `Generated on: ${now}`;

      const entry = {
        seed, size: size + "x" + size, time: now, chaosLevel: chaosLevel,
        id: Date.now(), favorited: false
      };
      saveHistory(entry);
      displayHistory();
    }

    function getCanvasSize() {
      const size = document.getElementById("canvasSize").value;
      if (size === "custom") {
        return parseInt(document.getElementById("customSize").value);
      }
      return parseInt(size);
    }

    function saveHistory(entry) {
      const history = JSON.parse(localStorage.getItem("pictureHistory") || "[]");
      history.push(entry);
      localStorage.setItem("pictureHistory", JSON.stringify(history));
    }

    function deleteHistory(id) {
      let history = JSON.parse(localStorage.getItem("pictureHistory") || "[]");
      history = history.filter(entry => entry.id !== id);
      localStorage.setItem("pictureHistory", JSON.stringify(history));
      displayHistory();
    }

    function toggleFavorite(id) {
      const history = JSON.parse(localStorage.getItem("pictureHistory") || "[]");
      const entry = history.find(e => e.id === id);
      entry.favorited = !entry.favorited;
      localStorage.setItem("pictureHistory", JSON.stringify(history));
      displayHistory();
    }

    function clearAllHistory() {
      localStorage.removeItem("pictureHistory");
      displayHistory();
    }

    function displayHistory() {
      const history = JSON.parse(localStorage.getItem("pictureHistory") || "[]").reverse();
      const favoritedList = document.getElementById("favoritedList");
      const historyList = document.getElementById("historyList");

      favoritedList.innerHTML = '';
      historyList.innerHTML = '';

      history.forEach(entry => {
        const div = document.createElement("div");
        div.className = `historyItem ${entry.favorited ? 'favorite' : ''}`;
        div.innerHTML = `
          <strong>Seed:</strong> ${entry.seed.slice(0, 10)}...<br>
          <strong>Size:</strong> ${entry.size}<br>
          <strong>Time:</strong> ${entry.time}<br>
          <strong>Chaotic:</strong> ${entry.chaosLevel}<br>
          <button onclick="toggleFavorite(${entry.id})">${entry.favorited ? 'Unfavorite' : 'Favorite'}</button>
          <button onclick="deleteHistory(${entry.id})">üóëÔ∏è Delete</button>
        `;
        if (entry.favorited) {
          favoritedList.appendChild(div);
        } else {
          historyList.appendChild(div);
        }
      });
    }

    function goToHub() {
      window.location.href = "hub.html";
    }

    // Load history on start
    displayHistory();
  </script>
</body>
</html>
